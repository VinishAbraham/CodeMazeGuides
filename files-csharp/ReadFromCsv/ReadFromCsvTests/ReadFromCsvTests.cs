using CsvHelper;
using CsvHelper.Configuration;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using ReadFromCsv;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using static System.Net.Mime.MediaTypeNames;

namespace ReadFromCsvTests
{
    [TestClass]
    public class ReadFromCsvTests
    {
        [TestMethod]
        public void GivenCsvFile_WhenReadingPersonsFromCsv_ThenListOfPersonsIsPopulated()
        {
            string csvFile =
                @"165773, Test Case, Modeling and Analysis - Patient View, Get Results and Export - Production Mode nThrive View,<steps id=""0"" last=""11""><step id=""2"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;&lt;SPAN style=""font-weight:bold""&gt;Pre-Conditions:&lt;/SPAN&gt; Fac: (VAL/RC) SBMQ, to be run in: nThrive View; (Prod) Hospital 9&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;See SUMMARY for Reference Zoom_9.mp4 video clip located on SharePoint. &lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""3"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""4"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Select ATB Date and select Process Detail Report. &lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Verify there is no popup: nThrive Reserve Management internal error.&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""5"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Clear the Query field&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;There Should be no Query in &amp;nbsp;Text Area&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""6"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;BR/&gt;Select ATB Date and select Process Detail Report. &lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page and Verify there is no popup with text : nThrive Reserve Management internal error.&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""7"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Verify that the Query field is blank as we cleared this field in step 4&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Query field should be blank&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""8"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;Enter some value in Query field and click on submit button&lt;BR/&gt;&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;User should be able to enter the value in Query field and should be able to save it&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""9"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;BR/&gt;Select ATB Date and select Process Detail Report. &lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page and Verify there is no popup: nThrive Reserve Management internal error.&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""10"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Verify the Query field value which was entered in step 7 is retained&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;DIV&gt;&lt;P&gt;The Query value should be retained&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=""11"" type=""ValidateStep""><parameterizedString isformatted=""true"">&lt;P&gt;User is in page nThrive Reserve Management Production Support Processes&lt;/P&gt;</parameterizedString><parameterizedString isformatted=""true"">&lt;P&gt;User should be in page &lt;SPAN style=""background-color: rgba(var(--palette-primary-tint-40,239, 246, 252),1);color: var(--text-primary-color,rgba(0, 0, 0, 0.9))""&gt;User should be in page nThrive Reserve Management Production Support Processes&lt;/SPAN&gt;&lt;/P&gt;</parameterizedString><description/></step></steps> ,Ready,Tester
                  2, Steve, False, 03/05/2006 00:00:00";

            var expectedPersons = new List<WorkItems>()
            {
                new WorkItems { Id = "165773", WorkItemType = "Test Case", Title = "Modeling and Analysis - Patient View, Get Results and Export - Production Mode nThrive View", Steps = "<steps id=\"0\" last=\"11\"><step id=\"2\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;&lt;SPAN style=\"font-weight:bold\"&gt;Pre-Conditions:&lt;/SPAN&gt; Fac: (VAL/RC) SBMQ, to be run in: nThrive View; (Prod) Hospital 9&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;See SUMMARY for Reference Zoom_9.mp4 video clip located on SharePoint. &lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"3\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"4\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Select ATB Date and select Process Detail Report. &lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Verify there is no popup: nThrive Reserve Management internal error.&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"5\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Clear the Query field&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;There Should be no Query in &amp;nbsp;Text Area&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"6\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;BR/&gt;Select ATB Date and select Process Detail Report. &lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page and Verify there is no popup with text : nThrive Reserve Management internal error.&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"7\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Verify that the Query field is blank as we cleared this field in step 4&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Query field should be blank&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"8\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;Enter some value in Query field and click on submit button&lt;BR/&gt;&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;User should be able to enter the value in Query field and should be able to save it&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"9\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Go To &amp;gt; nThrive Reserve Management &amp;gt; Production Support &amp;gt; Processes&lt;BR/&gt;Select ATB Date and select Process Detail Report. &lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;You should be taken to the MedAssets Reserve Management Production Support - Processes page and Verify there is no popup: nThrive Reserve Management internal error.&lt;BR/&gt;&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"10\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;DIV&gt;&lt;P&gt;Verify the Query field value which was entered in step 7 is retained&lt;/P&gt;&lt;/DIV&gt;&lt;/DIV&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;DIV&gt;&lt;P&gt;The Query value should be retained&lt;/P&gt;&lt;/DIV&gt;</parameterizedString><description/></step><step id=\"11\" type=\"ValidateStep\"><parameterizedString isformatted=\"true\">&lt;P&gt;User is in page nThrive Reserve Management Production Support Processes&lt;/P&gt;</parameterizedString><parameterizedString isformatted=\"true\">&lt;P&gt;User should be in page &lt;SPAN style=\"background-color: rgba(var(--palette-primary-tint-40,239, 246, 252),1);color: var(--text-primary-color,rgba(0, 0, 0, 0.9))\"&gt;User should be in page nThrive Reserve Management Production Support Processes&lt;/SPAN&gt;&lt;/P&gt;</parameterizedString><description/></step></steps>",State = "Ready",Tags = "Tester"},
                //new WorkItem { Id = 2, IsLiving = true, Name = "Steve", DateOfBirth = Convert.ToDateTime("03/09/1998") },
                
            };

            using (var test_Stream = new MemoryStream(Encoding.UTF8.GetBytes(csvFile)))
            {
                var config = new CsvConfiguration(CultureInfo.InvariantCulture)
                {
                    HasHeaderRecord = false,
                };

                using (var reader = new StreamReader(test_Stream))
                using (var csv = new CsvReader(reader, config))
                {
                    var records = csv.GetRecords<WorkItems>();
                    Console.WriteLine(records);

                    Assert.AreEqual(expectedPersons.Count, records.Count());
                }
            }
        }
    }
}